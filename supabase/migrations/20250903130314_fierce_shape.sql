/*
  # Create footer_pages table

  1. New Tables
    - `footer_pages`
      - `id` (uuid, primary key)
      - `slug` (text, unique) - URL slug for the page
      - `title` (text) - Page title
      - `content` (text) - Page content in markdown
      - `is_active` (boolean) - Whether page is visible in footer
      - `created_at` (timestamp)
      - `updated_at` (timestamp)

  2. Security
    - Enable RLS on `footer_pages` table
    - Add policy for public read access to active pages
    - Add policy for admin users to manage all pages

  3. Initial Data
    - Insert default footer pages with content
*/

-- Create footer_pages table
CREATE TABLE IF NOT EXISTS footer_pages (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  slug text UNIQUE NOT NULL,
  title text NOT NULL,
  content text NOT NULL,
  is_active boolean DEFAULT true,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);

-- Enable RLS
ALTER TABLE footer_pages ENABLE ROW LEVEL SECURITY;

-- Create policies
CREATE POLICY "Public can read active footer pages"
  ON footer_pages
  FOR SELECT
  TO public
  USING (is_active = true);

CREATE POLICY "Admin users can manage footer pages"
  ON footer_pages
  FOR ALL
  TO authenticated
  USING (
    EXISTS (
      SELECT 1 FROM user_roles 
      WHERE user_roles.user_id = auth.uid() 
      AND user_roles.role = 'admin'
    )
  )
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM user_roles 
      WHERE user_roles.user_id = auth.uid() 
      AND user_roles.role = 'admin'
    )
  );

CREATE POLICY "Service role can manage footer pages"
  ON footer_pages
  FOR ALL
  TO service_role
  USING (true)
  WITH CHECK (true);

-- Create updated_at trigger
CREATE OR REPLACE FUNCTION update_footer_pages_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_footer_pages_updated_at
  BEFORE UPDATE ON footer_pages
  FOR EACH ROW
  EXECUTE FUNCTION update_footer_pages_updated_at();

-- Insert default footer pages
INSERT INTO footer_pages (slug, title, content, is_active) VALUES
(
  'about',
  'Ποιοί είμαστε',
  '# Ποιοί είμαστε

## Η Αποστολή μας
Το MetroBusiness δημιουργήθηκε με στόχο να συνδέσει τις τοπικές επιχειρήσεις της Θεσσαλονίκης με τους επιβάτες του νέου μετρό. Πιστεύουμε ότι η αστική κινητικότητα μπορεί να ενισχύσει την τοπική οικονομία και να δημιουργήσει νέες ευκαιρίες για όλους.

## Το Όραμά μας
Οραματιζόμαστε μια Θεσσαλονίκη όπου κάθε διαδρομή με το μετρό είναι μια ευκαιρία για ανακάλυψη. Θέλουμε να κάνουμε την πόλη πιο προσβάσιμη, τις επιχειρήσεις πιο ορατές και τη ζωή των πολιτών πιο εύκολη και ενδιαφέρουσα.

## Για τους Πολίτες
- Ανακαλύψτε νέες επιχειρήσεις κοντά στις στάσεις μετρό
- Βρείτε αποκλειστικές προσφορές και εκπτώσεις
- Εξοικονομήστε χρόνο με έξυπνη πλοήγηση
- Υποστηρίξτε την τοπική οικονομία

## Για τις Επιχειρήσεις
- Προσελκύστε νέους πελάτες από το μετρό
- Αυξήστε την ορατότητά σας στην περιοχή
- Προωθήστε τις προσφορές σας εύκολα
- Αναπτύξτε το brand σας τοπικά

## Η Ιστορία μας
Το MetroBusiness ξεκίνησε το 2024 ως μια ιδέα για να αξιοποιήσουμε τη νέα εποχή που φέρνει το μετρό στη Θεσσαλονίκη. Η ομάδα μας αποτελείται από τοπικούς επιχειρηματίες, developers και ανθρώπους που αγαπούν την πόλη μας.',
  true
),
(
  'how-it-works',
  'Πώς λειτουργεί',
  '# Πώς λειτουργεί

## Για τους Χρήστες

### 1. Αναζήτηση
Επιλέξτε τη στάση μετρό που σας ενδιαφέρει ή αναζητήστε συγκεκριμένη επιχείρηση

### 2. Ανακάλυψη
Δείτε επιχειρήσεις και προσφορές σε ακτίνα 200 μέτρων από τη στάση που επιλέξατε

### 3. Επίσκεψη
Χρησιμοποιήστε την πλοήγηση για να φτάσετε στην επιχείρηση και να αξιοποιήσετε την προσφορά

## Για τις Επιχειρήσεις

### 1. Εγγραφή
Καταχωρήστε την επιχείρησή σας στην πλατφόρμα με απλά βήματα

### 2. Προσφορές
Δημιουργήστε ελκυστικές προσφορές για να προσελκύσετε πελάτες από το μετρό

### 3. Ανάπτυξη
Αποκτήστε νέους πελάτες και αναπτύξτε την επιχείρησή σας

## Γιατί MetroBusiness;

### Στρατηγική Τοποθεσία
Οι επιχειρήσεις κοντά στις στάσεις μετρό έχουν φυσικό πλεονέκτημα προσβασιμότητας

### Στοχευμένο Κοινό
Χιλιάδες επιβάτες περνούν καθημερινά από τις στάσεις - το ιδανικό κοινό για τις επιχειρήσεις

### Εύκολη Χρήση
Απλή και διαισθητική πλατφόρμα που μπορεί να χρησιμοποιήσει οποιοσδήποτε

### Τοπική Εστίαση
Επικεντρωμένοι αποκλειστικά στη Θεσσαλονίκη και τις ανάγκες της τοπικής κοινότητας',
  true
),
(
  'contact',
  'Επικοινωνία',
  '# Επικοινωνία

## Στοιχεία Επικοινωνίας

### Email
- **Γενικές πληροφορίες:** info@buybymetro.gr
- **Υποστήριξη:** support@buybymetro.gr

### Τηλέφωνο
- **Κύριο:** +30 2310 123 456
- **Ωράριο:** Δευτέρα - Παρασκευή, 9:00 - 18:00

### Διεύθυνση
Τσιμισκή 100  
54622 Θεσσαλονίκη

## Ωράριο Εξυπηρέτησης
- **Δευτέρα - Παρασκευή:** 9:00 - 18:00
- **Σάββατο:** 10:00 - 15:00
- **Κυριακή:** Κλειστά

## Για Επιχειρήσεις
Εάν έχετε επιχείρηση και θέλετε να συμμετάσχετε στην πλατφόρμα μας, επικοινωνήστε μαζί μας για περισσότερες πληροφορίες σχετικά με τα πακέτα και τις δυνατότητες που προσφέρουμε.',
  true
),
(
  'terms',
  'Όροι Χρήσης',
  '# Όροι Χρήσης

*Τελευταία ενημέρωση: 1 Ιανουαρίου 2025*

## 1. Αποδοχή Όρων
Με την πρόσβαση και χρήση της πλατφόρμας MetroBusiness, αποδέχεστε πλήρως και ανεπιφύλακτα τους παρόντες όρους χρήσης. Εάν δεν συμφωνείτε με οποιονδήποτε από αυτούς τους όρους, παρακαλούμε μην χρησιμοποιείτε την υπηρεσία μας.

## 2. Περιγραφή Υπηρεσίας
Το MetroBusiness είναι μια ψηφιακή πλατφόρμα που συνδέει τις τοπικές επιχειρήσεις της Θεσσαλονίκης με τους επιβάτες του μετρό. Η υπηρεσία μας περιλαμβάνει:

- Εύρεση επιχειρήσεων κοντά στις στάσεις μετρό
- Προβολή προσφορών και εκπτώσεων
- Πληροφορίες επικοινωνίας και ωραρίων
- Πλοήγηση προς τις επιχειρήσεις
- Δυνατότητα καταχώρησης επιχειρήσεων

## 3. Υποχρεώσεις Χρηστών

### Για όλους τους χρήστες:
- Παροχή ακριβών και ενημερωμένων στοιχείων
- Σεβασμός των δικαιωμάτων άλλων χρηστών
- Μη κακόβουλη χρήση της πλατφόρμας
- Συμμόρφωση με την ισχύουσα νομοθεσία

### Για επιχειρήσεις:
- Εγγύηση της ακρίβειας των στοιχείων επιχείρησης
- Τήρηση των προσφερόμενων εκπτώσεων και προσφορών
- Ενημέρωση για αλλαγές στα ωράρια ή τις υπηρεσίες
- Σεβασμός των δικαιωμάτων των καταναλωτών

## 4. Πνευματικά Δικαιώματα
Όλο το περιεχόμενο της πλατφόρμας MetroBusiness, συμπεριλαμβανομένων κειμένων, εικόνων, λογοτύπων και κώδικα, προστατεύεται από πνευματικά δικαιώματα.

## 5. Περιορισμός Ευθύνης
Το MetroBusiness λειτουργεί ως διαμεσολαβητής μεταξύ επιχειρήσεων και καταναλωτών. Δεν φέρουμε ευθύνη για την ποιότητα των προϊόντων ή υπηρεσιών των επιχειρήσεων.

## 6. Εφαρμοστέο Δίκαιο
Οι παρόντες όροι διέπονται από το ελληνικό δίκαιο. Τυχόν διαφορές υπάγονται στην αρμοδιότητα των δικαστηρίων Θεσσαλονίκης.',
  true
),
(
  'privacy',
  'Πολιτική Απορρήτου',
  '# Πολιτική Απορρήτου

*Τελευταία ενημέρωση: 1 Ιανουαρίου 2025*

## 1. Συλλογή Προσωπικών Δεδομένων
Συλλέγουμε τα ακόλουθα προσωπικά δεδομένα για τη λειτουργία της πλατφόρμας:

### Για Καταναλωτές
- Τοποθεσία (για εύρεση κοντινών επιχειρήσεων)
- Προτιμήσεις αναζήτησης
- Ιστορικό περιήγησης στην εφαρμογή
- Email (εάν εγγραφείτε)

### Για Επιχειρήσεις
- Στοιχεία επιχείρησης (όνομα, διεύθυνση)
- Στοιχεία επικοινωνίας
- Email και κωδικός πρόσβασης
- Φωτογραφίες και περιγραφές
- Στοιχεία προσφορών

## 2. Χρήση Δεδομένων
Χρησιμοποιούμε τα προσωπικά σας δεδομένα για τους ακόλουθους σκοπούς:

- Παροχή και βελτίωση των υπηρεσιών μας
- Εξατομίκευση της εμπειρίας χρήσης
- Επικοινωνία σχετικά με την υπηρεσία
- Στατιστική ανάλυση και βελτίωση της πλατφόρμας
- Συμμόρφωση με νομικές υποχρεώσεις

## 3. Προστασία Δεδομένων
Λαμβάνουμε σοβαρά μέτρα για την προστασία των προσωπικών σας δεδομένων:

- **Κρυπτογράφηση:** Όλα τα δεδομένα μεταδίδονται με SSL/TLS κρυπτογράφηση
- **Ασφαλής αποθήκευση:** Χρησιμοποιούμε ασφαλείς servers με περιορισμένη πρόσβαση
- **Περιορισμένη πρόσβαση:** Μόνο εξουσιοδοτημένο προσωπικό έχει πρόσβαση
- **Τακτικές ελέγχους:** Διενεργούμε τακτικούς ελέγχους ασφαλείας

## 4. Τα Δικαιώματά σας
Σύμφωνα με τον GDPR και την ελληνική νομοθεσία, έχετε τα ακόλουθα δικαιώματα:

- Πρόσβαση στα δεδομένα σας
- Διόρθωση λανθασμένων στοιχείων
- Διαγραφή των δεδομένων σας
- Περιορισμός επεξεργασίας
- Φορητότητα δεδομένων
- Εναντίωση στην επεξεργασία

## 5. Επικοινωνία
Για οποιεσδήποτε ερωτήσεις σχετικά με την πολιτική απορρήτου ή τα δικαιώματά σας, μπορείτε να επικοινωνήσετε μαζί μας στο email: privacy@buybymetro.gr',
  true
),
(
  'cookies',
  'Πολιτική Cookies',
  '# Πολιτική Cookies

*Τελευταία ενημέρωση: 1 Ιανουαρίου 2025*

## Τι είναι τα Cookies
Τα cookies είναι μικρά αρχεία κειμένου που αποθηκεύονται στη συσκευή σας όταν επισκέπτεστε μια ιστοσελίδα. Μας βοηθούν να θυμόμαστε τις προτιμήσεις σας και να βελτιώνουμε την εμπειρία χρήσης.

## Τύποι Cookies που Χρησιμοποιούμε

### Απαραίτητα Cookies
Απαιτούνται για τη βασική λειτουργία της ιστοσελίδας και δεν μπορούν να απενεργοποιηθούν. Περιλαμβάνουν cookies για την ασφάλεια, τη σύνδεση και τις βασικές λειτουργίες.

### Cookies Ανάλυσης
Συλλέγουν ανώνυμες πληροφορίες για το πώς χρησιμοποιείτε την ιστοσελίδα, όπως ποιες σελίδες επισκέπτεστε και πόσο χρόνο περνάτε σε κάθε σελίδα.

### Cookies Marketing
Χρησιμοποιούνται για να σας εμφανίζουμε σχετικές προσφορές και διαφημίσεις βασισμένες στα ενδιαφέροντά σας.

### Cookies Προτιμήσεων
Αποθηκεύουν τις προτιμήσεις σας όπως τη γλώσσα, την τοποθεσία και άλλες ρυθμίσεις για καλύτερη εμπειρία χρήσης.

## Διαχείριση Cookies
Μπορείτε να διαχειριστείτε τις προτιμήσεις σας για cookies μέσω των ρυθμίσεων του browser σας.

## Τρίτα Μέρη
Ενδέχεται να χρησιμοποιούμε υπηρεσίες τρίτων που τοποθετούν δικά τους cookies:

- Google Analytics (για στατιστικά επισκεψιμότητας)
- OpenStreetMap (για χάρτες)
- Supabase (για αποθήκευση δεδομένων)',
  true
) ON CONFLICT (slug) DO NOTHING;